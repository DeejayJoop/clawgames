<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Christmas Tree Decorator — Clawgames</title>
  <style>
    :root{--bg:#070518;--fg:#f4f6ff;--muted:#c7c8ff;--cyan:#67f5ff;--pink:#ff4fd8;--gold:#ffd66b;--good:#7dffcf;--bad:#ff5666;}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 900px at 50% 30%, #12301d, #0a1020 55%, var(--bg) 100%);
      color:var(--fg);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden}
    header,footer{padding:10px 14px;border-bottom:1px solid rgba(255,255,255,.10);
      background:linear-gradient(to bottom, rgba(255,255,255,.08), rgba(255,255,255,0))}
    footer{border-bottom:none;border-top:1px solid rgba(255,255,255,.10);
      background:linear-gradient(to top, rgba(255,255,255,.08), rgba(255,255,255,0));color:var(--muted)}
    h1{margin:0;font-size:14px;letter-spacing:.12em;text-transform:uppercase}
    .sub{margin-top:4px;color:var(--muted);font-size:12px}
    a{color:var(--cyan)}

    main{max-width:1100px;margin:0 auto;padding:14px;display:grid;grid-template-columns:360px 1fr;gap:12px}
    @media (max-width: 920px){ main{grid-template-columns:1fr} }

    .panel,.stageWrap{border:1px solid rgba(255,255,255,.16);border-radius:16px;background:rgba(0,0,0,.22);
      box-shadow:0 20px 60px rgba(0,0,0,.45);backdrop-filter: blur(10px);overflow:hidden}

    .panel{padding:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    label{color:var(--muted);font-size:12px}
    button,select,input{appearance:none;border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.25);
      color:var(--fg);border-radius:12px;padding:10px 12px;font:inherit}
    button{cursor:pointer;background:linear-gradient(180deg, rgba(125,255,207,.18), rgba(125,255,207,.06));
      box-shadow:0 10px 28px rgba(125,255,207,.08);font-weight:850}
    button.secondary{background:rgba(0,0,0,.22);box-shadow:none;font-weight:650}
    button:active{transform:translateY(1px)}

    .swatch{width:18px;height:18px;border-radius:6px;border:1px solid rgba(255,255,255,.22);display:inline-block;vertical-align:middle;margin-right:6px}

    .stageWrap{display:grid;place-items:center;padding:12px}
    canvas{width:min(680px, 96vw);height:auto;aspect-ratio:3/4;display:block;border-radius:14px;border:1px solid rgba(255,255,255,.10)}

    .hint{margin-top:10px;color:var(--muted);font-size:12px;line-height:1.5}
    .pill{border:1px solid rgba(255,255,255,.18);background:rgba(0,0,0,.22);border-radius:999px;padding:6px 10px;display:inline-flex;gap:10px;align-items:center;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <header>
    <h1>Christmas Tree Decorator</h1>
    <div class="sub">Click to place ornaments, drag to move, right‑click / long‑press to delete. Back to <a href="./index.html">games shelf</a>.</div>
  </header>

  <main>
    <div class="panel">
      <div class="row" style="justify-content:space-between">
        <div class="pill">Tool: <b id="toolName" style="color:var(--fg)">Ornament</b></div>
        <div class="pill">Ornaments: <b id="count" style="color:var(--fg)">0</b></div>
      </div>

      <div style="height:10px"></div>

      <div class="row">
        <div>
          <label for="shape">Shape</label><br/>
          <select id="shape">
            <option value="ball" selected>Ball</option>
            <option value="star">Star</option>
            <option value="candy">Candy cane</option>
            <option value="light">Light</option>
          </select>
        </div>
        <div>
          <label for="color">Color</label><br/>
          <input id="color" type="color" value="#ff4fd8" />
        </div>
        <div>
          <label for="size">Size</label><br/>
          <input id="size" type="range" min="10" max="40" value="22" />
        </div>
      </div>

      <div style="height:10px"></div>

      <div class="row">
        <button id="undo" class="secondary">Undo</button>
        <button id="clear" class="secondary">Clear</button>
        <button id="snow" class="secondary">Snow: On</button>
        <button id="export">Export PNG</button>
      </div>

      <div class="hint">
        <b>How to play:</b>
        <ul>
          <li>Click on the tree to place decorations.</li>
          <li>Drag an ornament to reposition it.</li>
          <li>Right-click (or long-press on mobile) to delete one.</li>
          <li>Export makes a PNG you can share.</li>
        </ul>
        <div>Tip: try a gold star on top.</div>
      </div>
    </div>

    <div class="stageWrap">
      <canvas id="c" width="720" height="960"></canvas>
    </div>
  </main>

  <footer>
    Made for fun. If you want: add garlands, presents, or a multiplayer “decorate together” mode.
  </footer>

<script>
(() => {
  const c = document.getElementById('c');
  const ctx = c.getContext('2d');

  const ui = {
    shape: document.getElementById('shape'),
    color: document.getElementById('color'),
    size: document.getElementById('size'),
    undo: document.getElementById('undo'),
    clear: document.getElementById('clear'),
    export: document.getElementById('export'),
    snow: document.getElementById('snow'),
    count: document.getElementById('count'),
    toolName: document.getElementById('toolName'),
  };

  let ornaments = []; // {x,y,shape,color,size,rot}
  let dragging = null; // index
  let dragOff = {x:0,y:0};
  let snowOn = true;

  // Snow particles
  const snow = Array.from({length: 120}, () => ({
    x: Math.random()*c.width,
    y: Math.random()*c.height,
    r: 0.8 + Math.random()*1.8,
    v: 0.4 + Math.random()*1.4,
    w: (Math.random()*2-1)*0.4
  }));

  function setCount(){ ui.count.textContent = String(ornaments.length); }

  function rnd(a,b){ return a + Math.random()*(b-a); }

  function drawBg(){
    // background gradient
    const g = ctx.createRadialGradient(c.width*0.5, c.height*0.25, 20, c.width*0.5, c.height*0.6, Math.max(c.width,c.height)*0.85);
    g.addColorStop(0,'rgba(125,255,207,0.10)');
    g.addColorStop(0.45,'rgba(255,79,216,0.08)');
    g.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,c.width,c.height);

    // subtle stars
    ctx.save();
    ctx.globalAlpha = 0.35;
    for(let i=0;i<90;i++){
      const x = (i*97)%c.width;
      const y = ((i*193)%c.height);
      ctx.fillStyle = 'rgba(244,246,255,1)';
      ctx.fillRect(x, y, 1.2, 1.2);
    }
    ctx.restore();
    ctx.globalAlpha = 1;
  }

  function drawTree(){
    const cx = c.width/2;
    const baseY = c.height*0.86;

    // trunk
    ctx.save();
    ctx.fillStyle = 'rgba(90,55,30,0.95)';
    roundRect(cx-40, baseY-60, 80, 80, 14);
    ctx.fill();

    // layers
    const layers = 4;
    for(let i=0;i<layers;i++){
      const t = i/(layers-1);
      const topY = c.height*0.13 + t*220;
      const bottomY = c.height*0.30 + t*220;
      const wTop = 40 + t*65;
      const wBot = 200 + t*110;

      const grad = ctx.createLinearGradient(0, topY, 0, bottomY);
      grad.addColorStop(0, `rgba(${20+10*i}, ${80+18*i}, ${40+10*i}, 0.95)`);
      grad.addColorStop(1, `rgba(${10+8*i}, ${55+12*i}, ${28+8*i}, 0.95)`);
      ctx.fillStyle = grad;

      ctx.beginPath();
      ctx.moveTo(cx, topY);
      ctx.lineTo(cx-wBot, bottomY);
      ctx.lineTo(cx+wBot, bottomY);
      ctx.closePath();
      ctx.fill();

      // edge glow
      ctx.strokeStyle = 'rgba(125,255,207,0.10)';
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    // base snow
    ctx.globalAlpha = 0.25;
    ctx.fillStyle = 'rgba(255,255,255,1)';
    ctx.beginPath();
    ctx.ellipse(cx, baseY+40, 250, 70, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;

    ctx.restore();
  }

  function drawOrnament(o){
    ctx.save();
    ctx.translate(o.x, o.y);
    ctx.rotate(o.rot);

    if(o.shape==='ball'){
      const r = o.size;
      const g = ctx.createRadialGradient(-r*0.25, -r*0.35, 2, 0, 0, r*1.2);
      g.addColorStop(0, 'rgba(255,255,255,0.85)');
      g.addColorStop(0.18, o.color);
      g.addColorStop(1, 'rgba(0,0,0,0.35)');
      ctx.fillStyle = g;
      ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();
      // cap
      ctx.fillStyle = 'rgba(255,214,107,0.9)';
      roundRect(-r*0.35, -r*1.15, r*0.7, r*0.35, 6);
      ctx.fill();
    }

    if(o.shape==='star'){
      const r = o.size;
      ctx.fillStyle = o.color;
      star(0,0,r*1.2,r*0.55,5);
      ctx.fill();
      ctx.globalAlpha=0.25;
      ctx.fillStyle='rgba(255,255,255,1)';
      star(-2,-2,r*1.0,r*0.45,5);
      ctx.fill();
      ctx.globalAlpha=1;
    }

    if(o.shape==='candy'){
      const w = o.size*1.2;
      const h = o.size*2.2;
      ctx.lineWidth = Math.max(4, o.size*0.22);
      ctx.lineCap = 'round';
      ctx.strokeStyle = o.color;
      ctx.beginPath();
      ctx.moveTo(-w*0.25, -h*0.35);
      ctx.quadraticCurveTo(-w*0.55, -h*0.75, 0, -h*0.80);
      ctx.quadraticCurveTo(w*0.65, -h*0.72, w*0.25, -h*0.20);
      ctx.lineTo(w*0.25, h*0.55);
      ctx.stroke();
      // stripes
      ctx.globalAlpha=0.25;
      ctx.strokeStyle='rgba(255,255,255,1)';
      ctx.beginPath();
      ctx.moveTo(-w*0.05, -h*0.35);
      ctx.lineTo(w*0.55, h*0.10);
      ctx.moveTo(-w*0.05, -h*0.05);
      ctx.lineTo(w*0.55, h*0.40);
      ctx.stroke();
      ctx.globalAlpha=1;
    }

    if(o.shape==='light'){
      const r = o.size*0.75;
      const glow = ctx.createRadialGradient(0,0,2,0,0,r*3.0);
      glow.addColorStop(0, o.color);
      glow.addColorStop(0.4, hexA(o.color, 0.25));
      glow.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = glow;
      ctx.beginPath(); ctx.arc(0,0,r*3.0,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = o.color;
      ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = 'rgba(255,214,107,0.9)';
      roundRect(-r*0.5, r*0.85, r, r*0.45, 6);
      ctx.fill();
    }

    ctx.restore();
  }

  function drawSnow(){
    if(!snowOn) return;
    ctx.save();
    ctx.fillStyle='rgba(255,255,255,0.7)';
    for(const s of snow){
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  function updateSnow(){
    if(!snowOn) return;
    for(const s of snow){
      s.y += s.v;
      s.x += s.w;
      if(s.y > c.height+10){ s.y = -10; s.x = Math.random()*c.width; }
      if(s.x < -10) s.x = c.width+10;
      if(s.x > c.width+10) s.x = -10;
    }
  }

  function render(){
    ctx.clearRect(0,0,c.width,c.height);
    drawBg();
    drawTree();
    // ornaments
    for(const o of ornaments) drawOrnament(o);
    updateSnow();
    drawSnow();
    // vignette
    const vg = ctx.createRadialGradient(c.width*0.5,c.height*0.55, c.width*0.15, c.width*0.5,c.height*0.55, c.width*0.85);
    vg.addColorStop(0,'rgba(0,0,0,0)');
    vg.addColorStop(1,'rgba(0,0,0,0.55)');
    ctx.fillStyle = vg;
    ctx.fillRect(0,0,c.width,c.height);
  }

  function getPos(e){
    const r = c.getBoundingClientRect();
    const x = (('touches' in e) ? e.touches[0].clientX : e.clientX) - r.left;
    const y = (('touches' in e) ? e.touches[0].clientY : e.clientY) - r.top;
    // map to canvas coordinates
    const sx = x * (c.width / r.width);
    const sy = y * (c.height / r.height);
    return {x:sx, y:sy};
  }

  function hitTest(pos){
    // topmost ornament first
    for(let i=ornaments.length-1;i>=0;i--){
      const o = ornaments[i];
      const dx = pos.x - o.x;
      const dy = pos.y - o.y;
      const rr = o.size*1.2;
      if(dx*dx + dy*dy < rr*rr) return i;
    }
    return null;
  }

  function addOrnament(pos){
    const o = {
      x: pos.x,
      y: pos.y,
      shape: ui.shape.value,
      color: ui.color.value,
      size: Number(ui.size.value),
      rot: rnd(-0.35, 0.35)
    };
    ornaments.push(o);
    setCount();
  }

  // pointer interactions
  let longPressTimer = null;
  function onDown(e){
    e.preventDefault();
    const pos = getPos(e);
    const idx = hitTest(pos);

    if(idx != null){
      dragging = idx;
      dragOff.x = pos.x - ornaments[idx].x;
      dragOff.y = pos.y - ornaments[idx].y;

      // long press to delete on touch
      if('touches' in e){
        clearTimeout(longPressTimer);
        longPressTimer = setTimeout(() => {
          ornaments.splice(idx,1);
          dragging = null;
          setCount();
        }, 600);
      }
    } else {
      addOrnament(pos);
    }
  }

  function onMove(e){
    if(dragging == null) return;
    e.preventDefault();
    const pos = getPos(e);
    ornaments[dragging].x = pos.x - dragOff.x;
    ornaments[dragging].y = pos.y - dragOff.y;
    clearTimeout(longPressTimer);
  }

  function onUp(e){
    clearTimeout(longPressTimer);
    dragging = null;
  }

  // right click delete
  c.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    const pos = getPos(e);
    const idx = hitTest(pos);
    if(idx != null){
      ornaments.splice(idx,1);
      setCount();
    }
  });

  c.addEventListener('mousedown', onDown);
  addEventListener('mousemove', onMove);
  addEventListener('mouseup', onUp);

  c.addEventListener('touchstart', onDown, {passive:false});
  c.addEventListener('touchmove', onMove, {passive:false});
  c.addEventListener('touchend', onUp, {passive:true});

  // UI buttons
  ui.undo.onclick = () => { ornaments.pop(); setCount(); };
  ui.clear.onclick = () => { ornaments = []; setCount(); };
  ui.snow.onclick = () => { snowOn = !snowOn; ui.snow.textContent = `Snow: ${snowOn?'On':'Off'}`; };

  ui.export.onclick = () => {
    // render once without vignette? keep it as-is.
    const a = document.createElement('a');
    a.download = 'christmas_tree.png';
    a.href = c.toDataURL('image/png');
    a.click();
  };

  ui.shape.onchange = () => ui.toolName.textContent = ui.shape.options[ui.shape.selectedIndex].text;

  function star(x,y,outer,inner,points){
    let rot = Math.PI/2*3;
    const step = Math.PI/points;
    ctx.beginPath();
    ctx.moveTo(x, y-outer);
    for(let i=0;i<points;i++){
      ctx.lineTo(x + Math.cos(rot)*outer, y + Math.sin(rot)*outer);
      rot += step;
      ctx.lineTo(x + Math.cos(rot)*inner, y + Math.sin(rot)*inner);
      rot += step;
    }
    ctx.closePath();
  }

  function roundRect(x,y,w,h,r){
    r = Math.min(r, w/2, h/2);
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y, x+w,y+h, r);
    ctx.arcTo(x+w,y+h, x,y+h, r);
    ctx.arcTo(x,y+h, x,y, r);
    ctx.arcTo(x,y, x+w,y, r);
    ctx.closePath();
  }

  function hexA(hex, a){
    const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    if(!m) return `rgba(255,255,255,${a})`;
    const r = parseInt(m[1],16), g = parseInt(m[2],16), b = parseInt(m[3],16);
    return `rgba(${r},${g},${b},${a})`;
  }

  // animation
  function loop(){
    render();
    requestAnimationFrame(loop);
  }

  ui.toolName.textContent = ui.shape.options[ui.shape.selectedIndex].text;
  setCount();
  loop();
})();
</script>
</body>
</html>
